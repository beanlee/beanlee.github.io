{"title":"iOS HTTPS 抓包工具配置说明","slug":"iOS-https","date":"2018-03-01T10:53:55.000Z","updated":"2018-06-20T01:31:47.235Z","comments":true,"path":"api/articles/iOS-https.json","excerpt":"相信各位在移动端开发过程中一定遇到抓取请求的场景，本文主要显示 iOS 11 在 Charles、Fiddler、Whistle 下HTTPS抓包配置，欢迎留言区补充其他工具。PS.留言使用 Disqus 插件需要科学上网。已经熟悉以上三个工具基础配置，仅仅需要解决抓包 iOS 下 HTTPS 问题的同学可以直接打开锦囊","covers":["https://img20.360buyimg.com/uba/jfs/t16375/210/2520307643/222582/31ac0971/5ab0a175N3cbadb49.png.webp","https://img10.360buyimg.com/uba/jfs/t17530/312/915989884/252348/b1b61faa/5ab0a1e7N47455815.png.webp","https://img13.360buyimg.com/uba/jfs/t16189/305/2463904253/229838/13248112/5ab0a246N431365b3.png.webp","https://img30.360buyimg.com/uba/jfs/t15991/176/2548641977/433484/2e35454f/5ab0a26cN86d8f8c1.png.webp","https://img14.360buyimg.com/uba/jfs/t17281/140/906435195/142935/49f55aa9/5ab0a4d4Nacbc29d6.png.webp","https://img10.360buyimg.com/uba/jfs/t19591/182/853494454/73346/71990549/5ab0a4acN9ee93450.png.webp","https://img14.360buyimg.com/uba/jfs/t14656/65/2745558691/37041/b26d6171/5ab0add4N3bd559a6.png.webp","https://img14.360buyimg.com/uba/jfs/t17401/70/901071906/48039/62c96f01/5ab0add7N4816f088.png.webp","https://img14.360buyimg.com/uba/jfs/t17362/179/900501459/1903822/f445defb/5ab0bcecNf4b0f762.png.webp","https://img30.360buyimg.com/uba/jfs/t15088/54/2660693956/316519/d9619a8c/5ab0a393Nc6ecb629.png.webp"],"content":"<p>相信各位在移动端开发过程中一定遇到抓取请求的场景，本文主要显示 iOS 11 在 <a href=\"#Charles\">Charles</a>、<a href=\"#Fiddler\">Fiddler</a>、<a href=\"#Whistle\">Whistle</a> 下HTTPS抓包配置，欢迎留言区补充其他工具。PS.留言使用 Disqus 插件需要<code>科学上网</code>。</p>\n<p>已经熟悉以上三个工具基础配置，仅仅需要解决抓包 iOS 下 HTTPS 问题的同学可以直接打开<a href=\"/2018/03/01/2018-03-01-iOS-https/#tips\">锦囊</a></p>\n<a id=\"more\"></a>\n<h2 id=\"Charles\"><a href=\"#Charles\" class=\"headerlink\" title=\"Charles\"></a>Charles<b id=\"Charles\"></b></h2><ul>\n<li><a href=\"https://www.charlesproxy.com/\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li>按照 license 收费，收费后终身享受升级，仅限 OS X 平台</li>\n</ul>\n<h3 id=\"HTTP-抓包\"><a href=\"#HTTP-抓包\" class=\"headerlink\" title=\"HTTP 抓包\"></a>HTTP 抓包</h3><h4 id=\"1-确保手机与主机处于同一局域网内。\"><a href=\"#1-确保手机与主机处于同一局域网内。\" class=\"headerlink\" title=\"1.确保手机与主机处于同一局域网内。\"></a>1.确保手机与主机处于同一局域网内。</h4><p>查看本机 IP，使用 <code>ifconfig</code> 命令查看本机 IP；或者打开系统设置查看 IP 如截图；</p>\n<p>当前本机 IP 192.168.191.4</p>\n<p><img src=\"https://img20.360buyimg.com/uba/jfs/t16375/210/2520307643/222582/31ac0971/5ab0a175N3cbadb49.png.webp\" alt=\"ifconfig\"></p>\n<p><img src=\"https://img10.360buyimg.com/uba/jfs/t17530/312/915989884/252348/b1b61faa/5ab0a1e7N47455815.png.webp\" alt=\"wifi-config\"></p>\n<h4 id=\"2-设置手机-iOS-网络代理\"><a href=\"#2-设置手机-iOS-网络代理\" class=\"headerlink\" title=\"2.设置手机 iOS 网络代理\"></a>2.设置手机 iOS 网络代理</h4><p><code>设置</code> -&gt; <code>无线局域网</code> -&gt; <code>HTTP 代理</code> -&gt; <code>手动</code></p>\n<p>服务器：<code>192.168.191.4</code> 端口：<code>8888</code></p>\n<h4 id=\"3-配置完成后，在手机端访问任何一个-App-或网页，本机-charles-会弹出提示，点击-Allow\"><a href=\"#3-配置完成后，在手机端访问任何一个-App-或网页，本机-charles-会弹出提示，点击-Allow\" class=\"headerlink\" title=\"3.配置完成后，在手机端访问任何一个 App 或网页，本机 charles 会弹出提示，点击 Allow\"></a>3.配置完成后，在手机端访问任何一个 App 或网页，本机 charles 会弹出提示，点击 Allow</h4><p>此时已经可以抓取 HTTP 数据了</p>\n<h3 id=\"HTTPS-抓包\"><a href=\"#HTTPS-抓包\" class=\"headerlink\" title=\"HTTPS 抓包\"></a>HTTPS 抓包</h3><h4 id=\"1-信任证书-本机\"><a href=\"#1-信任证书-本机\" class=\"headerlink\" title=\"1.信任证书 本机\"></a>1.信任证书 本机</h4><p>打开 charles 后如下图操作，本机信任 charles 证书，<strong>注意</strong> 此处选择<code>system</code></p>\n<p><img src=\"https://img13.360buyimg.com/uba/jfs/t16189/305/2463904253/229838/13248112/5ab0a246N431365b3.png.webp\" alt=\"charles-install-root-cer\"></p>\n<p><img src=\"https://img30.360buyimg.com/uba/jfs/t15991/176/2548641977/433484/2e35454f/5ab0a26cN86d8f8c1.png.webp\" alt=\"charles-install-root-cer-system\"></p>\n<h4 id=\"2-信任证书-手机\"><a href=\"#2-信任证书-手机\" class=\"headerlink\" title=\"2.信任证书 手机\"></a>2.信任证书 手机</h4><p>打开 <code>safari</code> 地址输入<code>192.168.191.4:8888</code>或<code>chls.pro/ssl</code>点击安装，此时会弹出要求需要输入手机密码，完成后证书安装成功。</p>\n<p>此时查看<code>通用</code>-&gt;<code>描述文件</code>中 charles proxy ca 已变成<code>已验证</code>。</p>\n<p><strong>注意</strong> 自 iOS 10.3 以上，还需要多一步操作，手动信任自定义根证书，才能确保证书安装并已启用；如图所示；</p>\n<p><code>关于本机</code>-&gt;<code>证书信任设置</code>启用 charles proxy ca 截图详见<a href=\"/2018/03/01/2018-03-01-iOS-https/#tips\">锦囊</a></p>\n<h4 id=\"3-Charles-设置启用-SSL-Proxy\"><a href=\"#3-Charles-设置启用-SSL-Proxy\" class=\"headerlink\" title=\"3. Charles 设置启用 SSL Proxy\"></a>3. Charles 设置启用 SSL Proxy</h4><p><code>Proxy</code>-&gt;<code>SSL Proxy setting</code> Enabled SSL Proxying</p>\n<p>同时增加希望抓取的域名，例如：<code>*.jd.com</code>端口 <code>443</code></p>\n<p><img src=\"https://img14.360buyimg.com/uba/jfs/t17281/140/906435195/142935/49f55aa9/5ab0a4d4Nacbc29d6.png.webp\" alt=\"charles-ssl-config01\"></p>\n<p><img src=\"https://img10.360buyimg.com/uba/jfs/t19591/182/853494454/73346/71990549/5ab0a4acN9ee93450.png.webp\" alt=\"charles-ssl-config02\"></p>\n<p><strong>配置完成</strong> : )</p>\n<h2 id=\"Fiddler\"><a href=\"#Fiddler\" class=\"headerlink\" title=\"Fiddler\"></a>Fiddler<b id=\"Fiddler\"></b></h2><ul>\n<li><a href=\"https://www.telerik.com/fiddler\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li>微软出品，免费，由于需要 .Net 库仅 Windows 平台</li>\n</ul>\n<h3 id=\"HTTP-抓包-1\"><a href=\"#HTTP-抓包-1\" class=\"headerlink\" title=\"HTTP 抓包\"></a>HTTP 抓包</h3><p>配置与 <code>Charles</code> 配置相同端口略有不同，此处不再重复</p>\n<p><img src=\"https://img14.360buyimg.com/uba/jfs/t14656/65/2745558691/37041/b26d6171/5ab0add4N3bd559a6.png.webp\" alt=\"fiddler01\"></p>\n<h3 id=\"HTTPS-抓包配置\"><a href=\"#HTTPS-抓包配置\" class=\"headerlink\" title=\"HTTPS 抓包配置\"></a>HTTPS 抓包配置</h3><ul>\n<li>勾选拦截 HTTPS 请求</li>\n<li>安装证书（电脑端 &amp; 手机端）</li>\n</ul>\n<p><img src=\"https://img14.360buyimg.com/uba/jfs/t17401/70/901071906/48039/62c96f01/5ab0add7N4816f088.png.webp\" alt=\"fiddler02\"></p>\n<h2 id=\"Whistle\"><a href=\"#Whistle\" class=\"headerlink\" title=\"Whistle\"></a>Whistle<b id=\"Whistle\"></b></h2><ul>\n<li><a href=\"https://avwo.github.io/whistle/\" target=\"_blank\" rel=\"noopener\">官网</a></li>\n<li>国人开发，开源 MIT 协议，基于 NodeJS 跨平台</li>\n<li><strong>推荐</strong></li>\n</ul>\n<h3 id=\"工具准备\"><a href=\"#工具准备\" class=\"headerlink\" title=\"工具准备\"></a>工具准备</h3><ul>\n<li><code>nodejs v0.10.0+</code></li>\n<li><code>npm i -g whistle</code></li>\n<li><code>w2 start</code></li>\n</ul>\n<p>完成上面几步操作后，此时<code>8899</code>端口已经常驻后台。</p>\n<h3 id=\"界面\"><a href=\"#界面\" class=\"headerlink\" title=\"界面\"></a>界面</h3><p><img src=\"https://img14.360buyimg.com/uba/jfs/t17362/179/900501459/1903822/f445defb/5ab0bcecNf4b0f762.png.webp\" alt=\"whistle\"></p>\n<h3 id=\"Chrome-插件\"><a href=\"#Chrome-插件\" class=\"headerlink\" title=\"Chrome 插件\"></a>Chrome 插件</h3><p>whistle 提供了一个基于 Chrome 的插件，可以方便切换代理，查看网络，编辑规则等，不过很遗憾作者已经将插件在 Web Store 下架，现在搜索不到，我把本地 0.10.0 版本打包成 crx 上传在 Google Driver 可以访问 <a href=\"https://drive.google.com/open?id=18RCuXBb_ml6OqLw-3PTSevcpJ81h-F27\" target=\"_blank\" rel=\"noopener\">下载</a></p>\n<p>或者改用另外一个强大的插件 <a href=\"https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif\" target=\"_blank\" rel=\"noopener\">Proxy SwitchyOmega</a></p>\n<h3 id=\"HTTPS-拦截配置\"><a href=\"#HTTPS-拦截配置\" class=\"headerlink\" title=\"HTTPS 拦截配置\"></a>HTTPS 拦截配置</h3><p><a href=\"https://avwo.github.io/whistle/webui/https.html\" target=\"_blank\" rel=\"noopener\">whistle 文档 https 设置部分</a></p>\n<h2 id=\"iOS-11-HTTPS-抓包锦囊\"><a href=\"#iOS-11-HTTPS-抓包锦囊\" class=\"headerlink\" title=\"iOS 11 HTTPS 抓包锦囊\"></a>iOS 11 HTTPS 抓包锦囊<b id=\"tips\"></b></h2><p><strong>注意</strong> 自 iOS 10.3 以后，无论使用上面哪一种工具抓包，安装完 ca 证书以后，还需要<strong>多一步操作</strong>，才能确保证书安装并已启用；</p>\n<p><code>通用</code> -&gt; <code>关于本机</code> -&gt; <code>证书信任设置</code> -&gt; 启用相对应的证书，就可以看到工具中抓取到相应的 HTTPS 请求。</p>\n<p><img src=\"https://img30.360buyimg.com/uba/jfs/t15088/54/2660693956/316519/d9619a8c/5ab0a393Nc6ecb629.png.webp\" alt=\"ios-cer\"></p>\n<p>这点跟苹果的 <strong>one more thing</strong> 貌似有那么一点不谋而合。</p>\n<p>have fun :D</p>\n","categories":[{"name":"前端技术","path":"api/categories/前端技术.json"}],"tags":[{"name":"移动开发","path":"api/tags/移动开发.json"}]}